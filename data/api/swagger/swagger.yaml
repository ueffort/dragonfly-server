swagger: "2.0"
info:
  version: "0.1.1"
  title: Limei Dragonfly Data Api
# during dev, should point to your local machine
host: 127.0.0.1:8181
# basePath prefixes all resource paths
basePath: /
#
schemes:
  # tip: remove http to make production-grade
  - http
# format of bodies a client can send (Content-Type)
consumes:
  - application/json
# format of the responses to the client (Accepts)
produces:
  - application/json
securityDefinitions:
  token:
    type: apiKey
    name: token
    in: header
paths:
  /auth:
    x-swagger-router-controller: auth
    get:
      description: "获取验证信息"
      operationId: getAuth
      security:
        - token: []
      parameters:
        - name: token
          in: query
          description: "token值"
          required: true
          type: string
      responses:
        "200":
          description: Success
          schema:
            $ref: "#/definitions/AuthModel"
        default:
          description: Error
          schema:
            $ref: "#/definitions/Error"
    post:
      description: "注册一个新的验证token"
      operationId: postAuth
      security:
        - token: []
      parameters:
        - name: email
          in: query
          description: "新token绑定的email"
          required: true
          type: string
      responses:
        "200":
          description: Success
          schema:
            $ref: "#/definitions/AuthModel"
        default:
          description: Error
          schema:
            $ref: "#/definitions/Error"
    put:
      description: "更新token绑定信息"
      operationId: putAuth
      security:
        - token: []
      parameters:
        - name: token
          in: query
          description: "token值"
          required: true
          type: string
        - name: email
          in: formData
          description: "关联email"
          required: false
          type: string
      responses:
        "200":
          description: Success
          schema:
            $ref: "#/definitions/AuthModel"
        default:
          description: Error
          schema:
            $ref: "#/definitions/Error"
    delete:
      description: "删除token"
      operationId: deleteAuth
      security:
        - token: []
      parameters:
        - name: token
          in: query
          description: "token值"
          required: true
          type: string
      responses:
        "200":
          description: Success
  /report:
    x-swagger-router-controller: report
    post:
      description: "注册一个报表对象"
      operationId: postReport
      security:
        - token: []
      parameters:
        - name: report
          in: body
          schema:
            $ref: "#/definitions/ReportModel"
          description: "报表信息，唯一标示符，不能重复"
      responses:
        "200":
          description: Success
        default:
          description: Error
          schema:
            $ref: "#/definitions/Error"
  /report/info/{name}:
    x-swagger-router-controller: report
    put:
      description: "更新报表信息"
      operationId: putReportInfo
      security:
        - token: []
      parameters:
        - name: name
          in: path
          description: "报表名称"
          type: string
          required: true
        - name: report
          in: body
          schema:
            $ref: "#/definitions/ReportModel"
          description: "报表信息"
      responses:
        "200":
          description: Success
        default:
          description: Error
          schema:
            $ref: "#/definitions/Error"
    get:
      description: "查询该报表当前状态"
      operationId: getReportInfo
      security:
        - token: []
      parameters:
        - name: name
          type: string
          in: path
          description: "报表名称"
          required: true
      responses:
        "200":
          description: Success
          schema:
            $ref: "#/definitions/ReportModel"
  /report/notice/{name}:
    x-swagger-router-controller: report
    put:
      description: "通知报表状态"
      operationId: putReportNotice
      security:
        - token: []
      parameters:
        - name: name
          type: string
          in: path
          description: "报表名称"
          required: true
        - name: time
          type: string
          in: query
          description: "报表执行时间:同一时间只记录最后的状态"
          required: true
        - name: state
          type: boolean
          in: formData
          description: "执行状态"
          required: true
        - name: description
          type: string
          in: formData
          description: "错误描述信息"
      responses:
        "200":
          description: Success
    get:
      description: "获取报表通知信息列表:返回长度和周期相关"
      operationId: getReportNotice
      security:
        - token: []
      parameters:
        - name: name
          type: string
          in: path
          description: "报表名称"
          required: true
      responses:
        "200":
            description: Success
            schema:
              type: array
              items:
                $ref: "#/definitions/ReportNoticeModel"
  /service:
    x-swagger-router-controller: service
    post:
      description: "注册一个服务对象，接入系统"
      operationId: postService
      security:
        - token: []
      parameters:
        - name: service
          in: body
          schema:
            $ref: "#/definitions/ServiceModel"
          description: "服务信息，唯一标示符，不能重复"
          required: true
      responses:
        "200": 
          description: Success
        default:
          description: Error
          schema:
            $ref: "#/definitions/Error"
    get:
      description: "获取服务列表"
      operationId: getService
      security:
        - token: []
      parameters:
        - name: name
          in: query
          description: "服务名称,like"
          type: string
        - name: dep
          in: query
          description: "依赖该服务的相关服务"
          type: string
        - name: state
          in: query
          description: "服务的状态:正常true,异常false"
          type: boolean
      responses:
        "200":
          description: Success
          schema:
            type: array
            items:
              $ref: "#/definitions/ServiceModel"
  /service/info/{name}:
    x-swagger-router-controller: service
    put:
      description: "更新服务信息"
      operationId: putServiceInfo
      security:
        - token: []
      parameters:
        - name: name
          type: string
          in: path
          description: "服务名称"
          required: true
        - name: service
          in: body
          schema:
            $ref: "#/definitions/ServiceModel"
          description: "服务信息"
      responses:
        "200":
          description: Success
        default:
          description: Error
          schema:
            $ref: "#/definitions/Error"
    get:
      description: "查询该服务当前状态"
      operationId: getServiceInfo
      security:
        - token: []
      parameters:
        - name: name
          type: string
          in: path
          description: "服务名称"
          required: true
      responses:
        "200":
          description: Success
          schema:
            $ref: "#/definitions/ServiceModel"
  /notice:
    x-swagger-router-controller: notice
    post:
      description: "发送通知给指定的用户"
      operationId: postNotice
      security:
        - token: []
      parameters:
        - name: subject
          type: string
          in: query
          description: "标题"
        - name: body
          type: string
          in: formData
          description: "正文"
        - name: to
          type: string
          in: formData
          description: "收件人"
      responses:
        "200":
          description: Success
  /agent:
    x-swagger-router-controller: agent
    get:
      description: "查询当前存在的agent列表"
      operationId: getAgent
      security:
        - token: []
      parameters:
        - name: advertiser
          type: string
          description: "agent启动的advertiser值,部分匹对"
          in: query
      responses:
        "200":
          description: Success
          schema:
            type: array
            items:
              $ref: "#/definitions/AgentModel"
  /data/campaign/cache/{id}:
    x-swagger-router-controller: data
    get:
      description: "获取campaign信息"
      operationId: getCampaignCache
      security:
        - token: []
      parameters:
        - name: id
          type: integer
          description: "campaignid"
          in: path
          required: true
      responses:
        "200":
          description: Success
          schema:
            $ref: "#/definitions/CampaignCache"
  /data/adgroup/cache/{id}:
    x-swagger-router-controller: data
    get:
      description: "获取adgroup信息"
      operationId: getAdgroupCache
      security:
        - token: []
      parameters:
        - name: id
          type: integer
          description: "adgroupid"
          in: path
          required: true
      responses:
        "200":
          description: Success
          schema:
            $ref: "#/definitions/AdgroupCache"
  /data/creative/cache/{id}:
    x-swagger-router-controller: data
    get:
      description: "获取creative信息"
      operationId: getCreativeCache
      security:
        - token: []
      parameters:
        - name: id
          type: integer
          description: "creativeid"
          in: path
          required: true
      responses:
        "200":
          description: Success
          schema:
            $ref: "#/definitions/CreativeCache"
  /data/campaign/filter/{id}:
    x-swagger-router-controller: data
    get:
      description: "获取campaign的过滤计数"
      operationId: getCampaignFilter
      security:
        - token: []
      parameters:
        - name: id
          type: integer
          description: "campaignid"
          in: path
          required: true
        - name: time
          type: integer
          description: "查询时间:只能查询当天的"
          in: query
          required: true
        - name: agent
          type: array
          items:
            type: string
          description: "对应agent所在的机器"
          in: query
          required: true
      responses:
        "200":
          description: Success
          schema:
            type: array
            items:
              $ref: "#/definitions/FilterInfo"
  /data/adgroup/filter/{id}:
    x-swagger-router-controller: data
    get:
      description: "获取campaign的过滤计数"
      operationId: getAdgroupFilter
      security:
        - token: []
      parameters:
        - name: id
          type: integer
          description: "adgroupid"
          in: path
          required: true
        - name: time
          type: integer
          description: "查询时间:只能查询当天的"
          in: query
          required: true
        - name: agent
          type: array
          items:
            type: string
          description: "对应agent所在的机器"
          in: query
          required: true
      responses:
        "200":
          description: Success
          schema:
            type: array
            items:
              $ref: "#/definitions/FilterInfo"
  /data/creative/filter/{id}:
    x-swagger-router-controller: data
    get:
      description: "获取campaign的过滤计数"
      operationId: getCreativeFilter
      security:
        - token: []
      parameters:
        - name: id
          type: integer
          description: "creativeid"
          in: path
          required: true
        - name: time
          type: integer
          description: "查询时间:只能查询当天的"
          in: query
          required: true
        - name: agent
          type: array
          items:
            type: string
          description: "对应agent所在的机器"
          in: query
          required: true
      responses:
        "200":
          description: Success
          schema:
            type: array
            items:
              $ref: "#/definitions/FilterInfo"
  /swagger:
    x-swagger-pipe: swagger_raw
definitions:
  AuthModel:
    properties:
      token:
        type: string
        description: "用于用户访问时的验证Token"
      email:
        type: string
        description: "关联该token的Email，用于自动发送相关邮件"
      state:
        type: boolean
        description: "当前状态：true为允许使用，false为不允许使用"
  ReportModel:
    properties:
      name:
        type: string
        description: "报表名称,唯一标示符"
      description:
        type: string
        description: "报表描述,作用及相关信息"
      period:
        type: string
        description: "报表执行周期:daily,hourly,weekly,monthly,custom"
      author:
        type: string
        description: "开发者,负责人,报警通知人"
  ReportNoticeModel:
    properties:
      name:
        type: string
        description: "报表名称,唯一标识符"
      time:
        type: string
        description: "报表时间"
      state:
        type: string
        description: "执行情况"
      number:
        type: integer
        description: "执行次数"
  ServiceModel:
    properties:
      name:
        type: string
        description: "服务名称,唯一标示符"
      description:
        type: string
        description: "服务描述，作用及相关信息"
      state:
        type: boolean
        description: "当前状态：true为正常，false为异常"
      depends:
        type: array
        description: "依赖服务"
        items:
          type: string
      author:
        type: string
        description: "开发者,负责人,报警通知人"
  AgentModel:
    properties:
      advertiser:
        type: string
        description: "agent启动时定义的advertiser,需要唯一"
      time:
        type: string
        description: "最后注册时间:Y-m-d H:i:s"
      number:
        type: integer
        description: "执行次数"
  CampaignCache:
    properties:
      id:
        type: integer
        description: "campaignId"
      
  AdgroupCache:
    properties:
      id:
        type: integer
        description: "adgroupId"
  CreativeCache:
    properties:
      id:
        type: integer
        description: "creativeId"
  FilterInfo:
    properties:
      attr:
        type: string
        description: "过滤字段"
      number:
        type: integer
        description: "过滤次数"
  Error:
    properties:
      status:
        type: number
        description: "错误状态码，http status"
      message:
        type: string
        description: "错误的描述信息，和具体业务相关"
